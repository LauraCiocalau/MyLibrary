{"ast":null,"code":"import { FormBuilder, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { HomeService } from '../../services/home.service';\nimport { Genre, Status } from '../../models/book.model';\nimport { catchError, finalize, takeUntil } from 'rxjs/operators';\nimport { Subject, throwError } from 'rxjs';\nimport { CommonModule } from '@angular/common';\nimport { HttpEventType } from '@angular/common/http';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../services/home.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nfunction EditBookComponent_form_4_option_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 26);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const genre_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", genre_r3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(genre_r3);\n  }\n}\nfunction EditBookComponent_form_4_option_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 26);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const status_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", status_r4);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(status_r4);\n  }\n}\nfunction EditBookComponent_form_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"form\", 5);\n    i0.ɵɵlistener(\"ngSubmit\", function EditBookComponent_form_4_Template_form_ngSubmit_0_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onFormSubmit());\n    });\n    i0.ɵɵelementStart(1, \"div\", 6)(2, \"label\", 7);\n    i0.ɵɵtext(3, \"Title\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"input\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 6)(6, \"label\", 9);\n    i0.ɵɵtext(7, \"Author\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"input\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 6)(10, \"label\", 11);\n    i0.ɵɵtext(11, \"ISBN\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"input\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 6)(14, \"label\", 13);\n    i0.ɵɵtext(15, \"Published Year\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(16, \"input\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"div\", 6)(18, \"label\", 15);\n    i0.ɵɵtext(19, \"Nr. of Pages\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(20, \"input\", 16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"div\", 6)(22, \"label\", 17);\n    i0.ɵɵtext(23, \"Genre\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"select\", 18);\n    i0.ɵɵtemplate(25, EditBookComponent_form_4_option_25_Template, 2, 2, \"option\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(26, \"div\", 6)(27, \"label\", 20);\n    i0.ɵɵtext(28, \"Image\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"input\", 21);\n    i0.ɵɵlistener(\"change\", function EditBookComponent_form_4_Template_input_change_29_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onFileSelected($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(30, \"div\", 6)(31, \"label\", 22);\n    i0.ɵɵtext(32, \"Status:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"select\", 23);\n    i0.ɵɵtemplate(34, EditBookComponent_form_4_option_34_Template, 2, 2, \"option\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(35, \"div\", 6)(36, \"button\", 24);\n    i0.ɵɵtext(37, \" Update book \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(38, \"a\", 25);\n    i0.ɵɵtext(39, \"Back\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.booksForm);\n    i0.ɵɵadvance(25);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.genres);\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.statuses);\n  }\n}\nexport let EditBookComponent = /*#__PURE__*/(() => {\n  class EditBookComponent {\n    constructor(fb, homeService, route, router) {\n      this.fb = fb;\n      this.homeService = homeService;\n      this.route = route;\n      this.router = router;\n      this.genres = Object.keys(Genre).filter(key => isNaN(Number(key)));\n      this.statuses = Object.keys(Status).filter(key => isNaN(Number(key)));\n      this.isLoading = false;\n      this.unsubscribe$ = new Subject();\n    }\n    ngOnInit() {\n      this.booksForm = this.fb.group({\n        title: ['', Validators.required],\n        author: ['', Validators.required],\n        isbn: [''],\n        publishedYear: [''],\n        numberOfPages: [''],\n        image: [''],\n        genre: ['', Validators.required],\n        status: [0, Validators.required]\n      });\n      // Obține ID-ul cărții din parametrii rutei și convertește-l la litere mari\n      const bookIdFromRoute = this.route.snapshot.paramMap.get('id') || '';\n      this.bookId = bookIdFromRoute.toUpperCase();\n      // Fetch book details\n      if (this.bookId) {\n        this.homeService.getBookById(this.bookId).subscribe(book => {\n          console.log('Fetched book:', book);\n          this.booksForm.patchValue({\n            title: book.title,\n            author: book.author,\n            isbn: book.isbn,\n            publishedYear: book.publishedYear,\n            numberOfPages: book.numberOfPages,\n            genre: book.genre,\n            status: book.status\n          });\n          console.log('Fetched book genre:', book.genre);\n        }, error => {\n          console.error('Error fetching book:', error);\n          alert('Could not fetch book details. Please try again later.');\n        });\n      }\n    }\n    onFormSubmit() {\n      console.log('Form submitted');\n      if (this.booksForm.invalid) {\n        console.log('Form is invalid');\n        this.showFormValidationErrors();\n        return;\n      }\n      console.log('Form is valid, preparing data');\n      this.isLoading = true;\n      const formData = new FormData();\n      Object.keys(this.booksForm.value).forEach(key => {\n        const value = key === 'genre' ? Genre[this.booksForm.get(key)?.value] : this.booksForm.get(key)?.value;\n        formData.append(key, value);\n      });\n      const imageControl = this.booksForm.get('image');\n      if (imageControl?.value) {\n        formData.append('image', imageControl.value);\n      } else {\n        const defaultImagePath = '/img/default.jpg';\n        formData.append('image', defaultImagePath);\n      }\n      this.homeService.updateBook(this.bookId, formData).pipe(catchError(error => {\n        console.error('Error Details:', error);\n        if (error.error && error.error.message) {\n          alert(`Something went wrong: ${error.error.message}`);\n        } else {\n          alert(`Something went wrong: ${error.message}`);\n        }\n        return throwError(() => new Error(`Something went wrong: ${error.message}`));\n      }), finalize(() => {\n        this.isLoading = false;\n      }), takeUntil(this.unsubscribe$)).subscribe({\n        next: event => {\n          if (event.type === HttpEventType.Response) {\n            console.log('Update response:', event.body);\n            console.log('Navigating to home page...');\n            this.router.navigate(['/home-page']);\n          } else {\n            console.log('Event type:', event.type); // Log other event types if necessary\n          }\n        },\n        error: err => {\n          console.error('Error:', err);\n          alert('An error occurred while submitting the form. Please try again later.');\n        }\n      });\n    }\n    showFormValidationErrors() {\n      for (const control in this.booksForm.controls) {\n        if (this.booksForm.controls.hasOwnProperty(control)) {\n          const ctrl = this.booksForm.controls[control];\n          if (ctrl.invalid) {\n            console.log(`Control ${control} is invalid`);\n          }\n          ctrl.markAsTouched();\n        }\n      }\n    }\n    ngOnDestroy() {\n      this.unsubscribe$.next();\n      this.unsubscribe$.complete();\n    }\n    onFileSelected(event) {\n      const input = event.target;\n      if (input.files && input.files.length > 0) {\n        this.booksForm.patchValue({\n          image: input.files[0]\n        });\n      }\n    }\n    static #_ = this.ɵfac = function EditBookComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || EditBookComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.HomeService), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Router));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: EditBookComponent,\n      selectors: [[\"app-edit-book\"]],\n      inputs: {\n        bookId: \"bookId\"\n      },\n      standalone: true,\n      features: [i0.ɵɵStandaloneFeature],\n      decls: 5,\n      vars: 1,\n      consts: [[1, \"landing-content\"], [1, \"flex\", \"h-screen\"], [1, \"books\"], [1, \"form-container\"], [\"class\", \"px-4\", 3, \"formGroup\", \"ngSubmit\", 4, \"ngIf\"], [1, \"px-4\", 3, \"ngSubmit\", \"formGroup\"], [1, \"mt-2\", \"fields\"], [\"for\", \"title\", 1, \"font-bold\", \"text-white\"], [\"type\", \"text\", \"id\", \"title\", \"formControlName\", \"title\", 1, \"w-full\", \"p-2\", \"border-2\", \"rounded-sm\", \"mt-2\"], [\"for\", \"author\", 1, \"font-bold\", \"text-white\"], [\"type\", \"text\", \"id\", \"author\", \"formControlName\", \"author\", 1, \"w-full\", \"p-2\", \"border-2\", \"rounded-sm\", \"mt-2\"], [\"for\", \"isbn\", 1, \"font-bold\", \"text-white\"], [\"type\", \"text\", \"id\", \"isbn\", \"formControlName\", \"isbn\", 1, \"w-full\", \"p-2\", \"border-2\", \"rounded-sm\", \"mt-2\"], [\"for\", \"publishedYear\", 1, \"font-bold\", \"text-white\"], [\"type\", \"text\", \"id\", \"publishedYear\", \"formControlName\", \"publishedYear\", 1, \"w-full\", \"p-2\", \"border-2\", \"rounded-sm\", \"mt-2\"], [\"for\", \"numberOfPages\", 1, \"font-bold\", \"text-white\"], [\"type\", \"number\", \"id\", \"numberOfPages\", \"formControlName\", \"numberOfPages\", 1, \"w-full\", \"p-2\", \"border-2\", \"rounded-sm\", \"mt-2\"], [\"for\", \"genre\", 1, \"font-bold\", \"text-white\"], [\"id\", \"genre\", \"formControlName\", \"genre\", 1, \"w-full\", \"p-2\", \"border-2\", \"rounded-sm\", \"mt-2\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"for\", \"image\", 1, \"font-bold\", \"text-white\"], [\"type\", \"file\", \"id\", \"image\", 1, \"w-full\", \"p-2\", \"border-2\", \"rounded-sm\", \"mt-2\", 3, \"change\"], [\"for\", \"status\", 1, \"font-bold\", \"text-white\"], [\"id\", \"status\", \"formControlName\", \"status\"], [\"type\", \"submit\", 1, \"btn\", \"mp-4\"], [\"href\", \"../home-page\", 1, \"link-back\"], [3, \"value\"]],\n      template: function EditBookComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3);\n          i0.ɵɵtemplate(4, EditBookComponent_form_4_Template, 40, 3, \"form\", 4);\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngIf\", ctx.booksForm);\n        }\n      },\n      dependencies: [ReactiveFormsModule, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, CommonModule, i4.NgForOf, i4.NgIf],\n      styles: [\".book-image[_ngcontent-%COMP%]{min-width:120px;max-height:180px;padding-bottom:10px}.landing-content[_ngcontent-%COMP%]{position:absolute;top:10vh;left:3%;width:fit-content;background:#222;z-index:2000;display:flex;justify-content:center;align-items:center;padding:18px 10px 10px;border-radius:4px;box-shadow:0 15px 35px #000;height:fit-content}.fields[_ngcontent-%COMP%]{position:relative}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%!important;color:#000;font-weight:700}button[_ngcontent-%COMP%]{position:relative;width:70%;height:40px;background:#0ef;box-shadow:0 0 10px #c5065f;font-size:16px;color:#000;font-weight:500;cursor:pointer;border-radius:30px;border:none;outline:none}button[_ngcontent-%COMP%]:hover{background-color:#000;color:#0ef;box-shadow:0 0 10px #c5065f}.link-back[_ngcontent-%COMP%]{margin-left:50px;color:#0ef}.link-back[_ngcontent-%COMP%]:hover{color:#c5065f}\"]\n    });\n  }\n  return EditBookComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}